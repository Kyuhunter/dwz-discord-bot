# Agent Rules for DWZ Discord Bot Project

## Overview
This file contains mandatory rules and guidelines for AI agents working on the DWZ Discord Bot project. These rules must be followed to maintain code quality, project structure, and development standards.

## Core Principles

### 1. Code Quality Standards
- **Clean Code**: Write readable, maintainable, and well-documented code
- **Consistent Style**: Follow existing code patterns and naming conventions
- **No Dead Code**: Remove unused imports, functions, and variables
- **Meaningful Names**: Use descriptive variable, function, and class names
- **Single Responsibility**: Each function/class should have one clear purpose
- **DRY Principle**: Don't repeat code; extract common functionality
- **Error Handling**: Always handle errors gracefully with proper logging

### 2. Test Coverage Requirements
- **Minimum Coverage**: Maintain 80% overall test coverage
- **Service Coverage**: Services must have 85% coverage minimum
- **Utility Coverage**: Utilities must have 85% coverage minimum
- **Test Quality**: Write meaningful tests that verify actual functionality
- **Test Organization**: Group tests logically with descriptive names
- **Mock Dependencies**: Properly mock external dependencies in unit tests
- **Integration Tests**: Include integration tests for critical workflows

### 3. Project Structure Rules
- **File Organization**: Follow existing directory structure strictly
  ```
  src/
  ├── commands/          # Discord slash commands
  ├── constants/         # Application constants
  ├── events/           # Discord event handlers
  ├── helpers/          # Helper utilities
  ├── services/         # Business logic services
  ├── utils/            # General utilities
  └── validators/       # Input validation
  tests/
  ├── unit/             # Unit tests
  ├── integration/      # Integration tests
  └── commands/         # Command-specific tests
  ```
- **Import Structure**: Use relative imports within the project
- **Export Consistency**: Use consistent export patterns (module.exports for Node.js)

### 4. Version Control Standards
- **Regular Commits**: Make small, focused commits with clear messages
- **Commit Messages**: Use conventional commit format: `type(scope): description`
  - Examples: `feat(commands): add dwz search command`, `fix(tests): resolve mock issues`
- **No Backup Files**: Never create .bak, .old, or similar backup files
- **Clean Working Directory**: Keep the repository clean of temporary files

### 5. Scope Limitations
- **Stay in Scope**: Only work on explicitly requested features or fixes
- **No Feature Creep**: Don't add unrequested functionality
- **Ask Before Major Changes**: Confirm large architectural changes with user
- **Preserve Existing Functionality**: Don't break working features

## Technical Standards

### 6. JavaScript/Node.js Specific
- **ES6+ Features**: Use modern JavaScript features appropriately
- **Async/Await**: Prefer async/await over Promises chains
- **Error Objects**: Always use proper Error objects, not strings
- **Constants**: Use constants for magic numbers and strings
- **JSDoc Comments**: Document public functions with JSDoc

### 7. Testing Standards
- **Test File Naming**: Use `.test.js` suffix for test files
- **Test Structure**: Use `describe`/`test` blocks with clear descriptions
- **Setup/Teardown**: Use `beforeEach`/`afterEach` for test isolation
- **Assertion Quality**: Use specific assertions, not just truthy/falsy
- **Mock Strategy**: Mock at the module boundary, not internal functions

### 8. Dependencies and Packages
- **Minimal Dependencies**: Only add necessary dependencies
- **Security**: Check for security vulnerabilities in dependencies
- **Version Locking**: Use specific versions in package.json
- **Dev Dependencies**: Properly separate dev and production dependencies

## Discord Bot Specific Rules

### 9. Discord.js Best Practices
- **Interaction Handling**: Always defer long-running interactions
- **Error Responses**: Provide user-friendly error messages
- **Permissions**: Check bot permissions before operations
- **Rate Limiting**: Respect Discord API rate limits
- **Embed Limits**: Respect Discord embed size limits (4096 chars description)

### 10. DWZ Search Functionality
- **Input Validation**: Always validate user input before processing
- **Search Safety**: Handle special characters in search queries
- **Result Limits**: Limit search results to prevent spam
- **Translation Support**: Use translation system for all user-facing text
- **Graceful Degradation**: Handle API failures gracefully

## File and Code Management

### 11. File Operations
- **No Backup Files**: Never create .bak, .backup, .old files
- **Atomic Operations**: Complete file operations or roll back
- **File Permissions**: Maintain appropriate file permissions
- **Path Handling**: Use path.join() for cross-platform compatibility

### 12. Configuration Management
- **Environment Variables**: Use .env for sensitive configuration
- **Config Validation**: Validate configuration on startup
- **Default Values**: Provide sensible defaults for optional config
- **Documentation**: Document all configuration options

## Quality Assurance

### 13. Before Committing
- [ ] All tests pass
- [ ] Code coverage meets requirements
- [ ] No linting errors
- [ ] No security vulnerabilities
- [ ] Documentation updated if needed
- [ ] No console.log statements in production code
- [ ] No TODO comments without issue references

### 14. Code Review Checklist
- [ ] Function/variable names are descriptive
- [ ] Error handling is comprehensive
- [ ] Tests cover edge cases
- [ ] No magic numbers or strings
- [ ] Proper logging levels used
- [ ] Performance considerations addressed

## Enforcement

### 15. Automated Checks
- **Jest**: Must pass all tests before committing
- **Coverage**: Coverage reports must meet thresholds
- **Linting**: Code must pass ESLint checks
- **Git Hooks**: Use pre-commit hooks to enforce standards

### 16. Manual Review Points
- **Architecture**: Does the change fit the existing architecture?
- **Performance**: Will this change impact performance?
- **Security**: Are there any security implications?
- **User Experience**: Does this improve or maintain UX?

## Common Patterns to Follow

### 17. Error Handling Pattern
```javascript
try {
  // Operation
  const result = await someOperation();
  return result;
} catch (error) {
  logger.error('Operation failed', { error: error.message, context });
  throw new CustomError('User-friendly message', error);
}
```

### 18. Test Pattern
```javascript
describe('Feature Name', () => {
  beforeEach(() => {
    // Setup mocks
  });

  test('should handle normal case', () => {
    // Arrange
    // Act
    // Assert
  });

  test('should handle edge case', () => {
    // Test edge cases
  });
});
```

### 19. Service Pattern
```javascript
class ServiceName {
  constructor(dependencies) {
    this.logger = dependencies.logger;
    this.config = dependencies.config;
  }

  async methodName(params) {
    // Validate input
    // Perform operation
    // Handle errors
    // Return result
  }
}
```

## Violations and Consequences

### 20. Critical Violations
- Breaking existing functionality
- Introducing security vulnerabilities
- Reducing test coverage below thresholds
- Creating backup files
- Committing sensitive information

### 21. Best Effort Guidelines
- Code documentation
- Performance optimization
- User experience improvements
- Code refactoring for clarity

---

**Remember**: These rules exist to maintain project quality and developer productivity. When in doubt, ask the user for clarification rather than making assumptions.

**Version**: 1.0  
**Last Updated**: July 6, 2025  
**Applies To**: All AI agents working on the DWZ Discord Bot project
